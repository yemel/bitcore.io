<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>Bitcore &mdash; A pure and powerful JavaScript Bitcoin API.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="canonical" href="http://bitcore.io/guide/transaction.html">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <link href="/css/animations.css" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Ubuntu:light,regular,bold&subset=Latin" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Ubuntu%20Mono:regular,bold&subset=Latin" rel="stylesheet" type="text/css">
  <link rel="alternative" href="/atom.xml" title="Bitcore" type="application/atom+xml">
  <meta name="description" content="Transaction
Description
Bitcore provides a very simple API for creating transactions. We expect this API to be accessible for developers without knowing the working internals of bitcoin in deep detail">
<meta property="og:type" content="website">
<meta property="og:title" content="Bitcore">
<meta property="og:url" content="http://bitcore.io/guide/transaction.html">
<meta property="og:site_name" content="Bitcore">
<meta property="og:description" content="Transaction
Description
Bitcore provides a very simple API for creating transactions. We expect this API to be accessible for developers without knowing the working internals of bitcoin in deep detail">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bitcore">
<meta name="twitter:description" content="Transaction
Description
Bitcore provides a very simple API for creating transactions. We expect this API to be accessible for developers without knowing the working internals of bitcoin in deep detail">
<meta name="twitter:site" content="@bitpay">

  
</head>


<body>
  <header id="header"  class="invert" >
  <div class="outer">
    <div class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Bitcore</a>
        <a id="main-nav-toggle"></a>
      </h1>
      <nav id="main-nav">
        <ul id="main-nav-list">
          
            <li class="main-nav-item">
              <a href="/guide/" class="main-nav-link docs">Docs</a>
            </li>
          
            <li class="main-nav-item">
              <a href="/api/" class="main-nav-link api">API</a>
            </li>
          
            <li class="main-nav-item">
              <a href="https://github.com/bitpay/bitcore" class="main-nav-link github">Github</a>
            </li>
          
        </ul>
      </nav>
    </div>
  </div>
</header>
  <article class="page" itemscope itemtype="http://schema.org/Article">
  <header id="page-banner">
    <div class="outer">
      <div id="page-banner-inner" class="inner">
        
        <h1 id="page-title" itemprop="name">Documentation</h1>
        
          <a href="https://github.com/bitpay/bitcore/blob/master/docs/guide/transaction.md" title="Improve this doc" id="page-edit-link"></a>
        
      </div>
    </div>
  </header>
  <div class="outer">
    <div id="mobile-menu-wrap"></div>
    <div class="page-content">
      <div class="toc-wrap">
        <strong class="toc-title">Contents</strong>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Transaction"><span class="toc-number">1.</span> <span class="toc-text">Transaction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description"><span class="toc-number">1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transaction_API"><span class="toc-number">1.2.</span> <span class="toc-text">Transaction API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Input"><span class="toc-number">1.3.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Output"><span class="toc-number">1.4.</span> <span class="toc-text">Output</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multisig_Transactions"><span class="toc-number">1.5.</span> <span class="toc-text">Multisig Transactions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Advanced_topics"><span class="toc-number">1.6.</span> <span class="toc-text">Advanced topics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Internal_Workings"><span class="toc-number">1.6.1.</span> <span class="toc-text">Internal Workings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unspent_Output_Selection"><span class="toc-number">1.6.2.</span> <span class="toc-text">Unspent Output Selection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upcoming_changes"><span class="toc-number">1.7.</span> <span class="toc-text">Upcoming changes</span></a></li></ol></li></ol>
      </div>
      <div class="page-entry" itemprop="articleBody">
        <h1 id="Transaction">Transaction</h1>
<h2 id="Description">Description</h2>
<p>Bitcore provides a very simple API for creating transactions. We expect this API to be accessible for developers without knowing the working internals of bitcoin in deep detail. What follows is a small introduction to transactions with some basic knowledge required to use this API.</p>
<p>A Transaction contains a set of inputs and a set of outputs. Each input contains a reference to another transaction’s output, and a signature that allows the value referenced in that ouput to be used in this transaction.</p>
<p>Note also that an output can be used only once. That’s why there’s a concept of “change address” in the bitcoin ecosystem: if an output of 10 BTC is available for me to spend, but I only need to transmit 1 BTC, I’ll create a transaction with two outputs, one with 1 BTC that I want to spend, and the other with 9 BTC to a change address, so I can spend this 9 BTC with another private key that I own.</p>
<p>So, in order to transmit a valid transaction, you must know what other transactions on the network store outputs that have not been spent and that are available for you to spend (meaning that you have the set of keys that can validate you own those funds). The unspent outputs are usually referred to as “utxo”s.</p>
<p>Let’s take a look at some very simple transactions:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> transaction = <span class="keyword">new</span> Transaction()</div><div class="line">    .from(utxos)          <span class="comment">// Feed information about what unspend outputs one can use</span></div><div class="line">    .to(address, amount)  <span class="comment">// Add an output with the given amount of satoshis</span></div><div class="line">    .change(address)      <span class="comment">// Sets up a change address where the rest of the funds will go</span></div><div class="line">    .sign(privkeySet)     <span class="comment">// Signs all the inputs it can</span></div></pre></td></tr></table></figure>

<p>Now, this could just be serialized to hexadecimal ASCII values (<code>transaction.serialize()</code>) and sent over to the bitcoind reference client.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bitcoin-cli sendrawtransaction &lt;serialized transaction&gt;</div></pre></td></tr></table></figure>

<p>You can also override the fee estimation with another amount, specified in satoshis:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> transaction = <span class="keyword">new</span> Transaction().fee(<span class="number">5430</span>); <span class="comment">// Minimum non-dust amount</span></div><div class="line"><span class="keyword">var</span> transaction = <span class="keyword">new</span> Transaction().fee(<span class="number">1e8</span>);  <span class="comment">// Generous fee of 1 BTC</span></div></pre></td></tr></table></figure>

<h2 id="Transaction_API">Transaction API</h2>
<h2 id="Input">Input</h2>
<p>Transaction inputs are instances of either <a href="https://github.com/bitpay/bitcore/tree/master/lib/transaction/input" target="_blank" rel="external">Input</a> or its subclasses.</p>
<h2 id="Output">Output</h2>
<p>Transaction outputs are a very thin wrapper around the information provided by a transaction output: its script and its output amount.</p>
<h2 id="Multisig_Transactions">Multisig Transactions</h2>
<p>To send a transaction to a multisig address, the API is the same as in the above example. To spend outputs that require multiple signatures, the process needs extra information: the public keys of the signers that can unlock that output.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> multiSigTx = <span class="keyword">new</span> Transaction()</div><div class="line">    .from(utxo, publicKeys, threshold)</div><div class="line">    .change(address)</div><div class="line">    .sign(myKeys);</div><div class="line"></div><div class="line"><span class="keyword">var</span> serialized = multiSigTx.serialize();</div></pre></td></tr></table></figure>

<p>This can be serialized and sent to another party, to complete with the needed signatures:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> multiSigTx = <span class="keyword">new</span> Transaction(serialized)</div><div class="line">    .from(utxo, publicKeys, threshold)       <span class="comment">// provide info about the multisig output</span></div><div class="line">                                             <span class="comment">// (lost on serialization)</span></div><div class="line">    .sign(anotherSetOfKeys);</div><div class="line"></div><div class="line">assert(multiSigTx.isFullySigned());</div></pre></td></tr></table></figure>

<h2 id="Advanced_topics">Advanced topics</h2>
<h3 id="Internal_Workings">Internal Workings</h3>
<p>There are a number of data structures being stored internally in a <code>Transaction</code> instance. These are kept up to date and change through successive calls to its methods.</p>
<ul>
<li><code>inputs</code>: The ordered set of inputs for this transaction</li>
<li><code>outputs</code>: This is the ordered set of output scripts</li>
<li><code>_inputAmount</code>: sum of the amount for all the inputs</li>
<li><code>_outputAmount</code>: sum of the amount for all the outputs</li>
<li><code>_fee</code>: if user specified a non-standard fee, the amount (in satoshis) will be stored in this variable so the change amount can be calculated.</li>
<li><code>_change</code>: stores the value provided by calling the <code>change</code> method.</li>
</ul>
<h3 id="Unspent_Output_Selection">Unspent Output Selection</h3>
<p>If you have a larger set of unspent outputs, only some of them will be selected to fulfill the amount. This is done by storing a cache of unspent outputs in a protected member called <code>_utxos</code>. When the <code>to()</code> method is called, some of these outputs will be selected to pay the requested amount to the appropriate address.</p>
<p>A detail that you should have in mind is that when the transaction is serialized, this cache can’t be included in the serialized form.</p>
<h2 id="Upcoming_changes">Upcoming changes</h2>
<p>We’re debating an API for Merge Avoidance, CoinJoin, Smart contracts, CoinSwap, and Stealth Addresses. We’re expecting to have all of them by some time in early 2015. First draft implementations of Payment Channel smart contracts extensions to this library are already being implemented independently.</p>

      </div>
      <footer id="page-footer">
        <time id="page-footer-updated" datetime="2014-12-22T18:49:15.000Z" itemprop="dateModified">Last updated: Dec 22 2014</time>
        <a href="index.html" id="page-footer-next" title="Get Started">Next</a>
      </footer>
      
    </div>
    <aside id="sidebar">

  

  
    <strong class="sidebar-title">Home</strong>
    
      <a href="/guide/index.html" class="sidebar-link">Get Started</a>
    
      <a href="/guide/contributing.html" class="sidebar-link">Contributing</a>
    
  
    <strong class="sidebar-title">Models</strong>
    
      <a href="/guide/address.html" class="sidebar-link">Address</a>
    
      <a href="/guide/block.html" class="sidebar-link">Block</a>
    
      <a href="/guide/hierarchical.html" class="sidebar-link">Hierarchical</a>
    
      <a href="/guide/privatekey.html" class="sidebar-link">Private Key</a>
    
      <a href="/guide/publickey.html" class="sidebar-link">Public Key</a>
    
      <a href="/guide/script.html" class="sidebar-link">Script</a>
    
      <a href="/guide/transaction.html" class="sidebar-link current">Transaction</a>
    
  
    <strong class="sidebar-title">Helpers</strong>
    
      <a href="/guide/crypto.html" class="sidebar-link">Crypto</a>
    
      <a href="/guide/ecies.html" class="sidebar-link">ECIES</a>
    
      <a href="/guide/encoding.html" class="sidebar-link">Encoding</a>
    
      <a href="/guide/networks.html" class="sidebar-link">Networks</a>
    
      <a href="/guide/paymentprotocol.html" class="sidebar-link">Payment Protocol</a>
    
      <a href="/guide/unit.html" class="sidebar-link">Unit</a>
    
      <a href="/guide/uri.html" class="sidebar-link">URI</a>
    
  
    <strong class="sidebar-title">Networking</strong>
    
      <a href="/guide/jsonrpc.html" class="sidebar-link">JSON-RPC</a>
    
      <a href="/guide/peer.html" class="sidebar-link">Peer</a>
    
      <a href="/guide/pool.html" class="sidebar-link">Pool</a>
    
  




</aside>
  </div>
</article>
  <footer id="footer">
  <div class="outer">
    <div class="inner">
      <div id="footer-copyright">
        <p>bitcore™ &copy; 2013-2014 BitPay, Inc. bitcore is released under the MIT license.</p>
      </div>
      <div id="footer-links">
        <a href="https://twitter.com/bitpay" id="footer-link-twitter" class="footer-link" target="_blank"><span>Twitter</span></a>
        <a href="https://github.com/bitpay/bitcore" id="footer-link-github" class="footer-link" target="_blank"><span>GitHub</span></a>
      </div>
    </div>
  </div>
</footer>
  
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/retina.min.js" type="text/javascript"></script>

<script src="/js/script.js" type="text/javascript"></script>

<!-- Google+ -->
<script type="text/javascript" src="//apis.google.com/js/plusone.js"></script>
<!-- Twitter -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

</body>
</html>